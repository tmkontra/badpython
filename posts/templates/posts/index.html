{% extends "posts/layout.html" %}
{% block content %}

<div class="row pt-2">
    <h1>BadPython.com</h1>
    <div class="ml-auto my-auto">
        <button class="btn btn-primary float-right">Submit Your Own</button>
    </div>
</div>

<div class="container mt-5">
    <div class="row d-flex justify-content-center">
        <h3>{{ post.title }}</h3>
    </div>
    <div id="code-container" class="container" style="max-width: 80%; position: relative; padding: 0px;">
        <button class='btn btn-outline-dark' id="suggestion" style="color: darkgray; border-color: dar;">
            <i class="far fa-lightbulb"></i>
            suggest...
        </button>
        <pre style="margin-bottom: 0.1rem;">
            <code id="code" class="python px-5" style="line-height: 1.5rem; min-height: 10%; max-height: 50%; overflow-y: scroll;">
{{ post.code }}
            </code>
        </pre>
        <div class="row" style="margin: auto;" class="mx-auto">
            <button id="bad-btn" class="btn btn-success">
                <i class="far fa-thumbs-up"></i>
                This <em>is</em> bad python!
            </button>
            <button id="not-bad-btn" class="btn btn-danger ml-auto">
                <i class="far fa-ban"></i>
                This isn't that bad!
            </button>
        </div>
    </div>
</div>

<script>
    set_suggest_button_position = function () {
        let c = $("#code");
        let x = c.position();
        let s = $("#suggestion");
        s.css({ top: x.top, right: x.left, position: 'absolute' });
    };
    $(window).on('resize', set_suggest_button_position);
    $(document).ready(function() { set_suggest_button_position(); set_suggest_button_position()});
    $("#code-container").bind("reposition", set_suggest_button_position);

    var post_url = '{% url "vote" post.id %}'
    
    let vote_for_post = function (is_bad) {
        console.log(`currying ${is_bad}`);
        let vote = function (ev) {
            fetch(post_url, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    isBad: is_bad,
                })
            }).then(response => console.log(`VOTE OK! ${is_bad}`))
        };
        return vote;
    };

    $("#bad-btn").click(vote_for_post(true));
    $("#not-bad-btn").click(vote_for_post(false));
</script>

{% endblock %}